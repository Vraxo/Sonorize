@typeparam TItem
@using Timer = System.Timers.Timer
@using Sonorize.Core
@using Sonorize.Core.Settings
@inject SonorizeSettings AppSettings
@inject NavigationManager Nav
@implements IDisposable

<LibraryHeader Title="@Title"
               @bind-SearchQuery="_searchQuery"
               OnSearchKeyUp="OnSearchKeyUp"
               ViewMode="ViewMode"
               ViewModeChanged="OnViewModeChangedInternal"
               OnSettingsClick="GoToSettings" />

@if (!_filteredItems.Any())
{
    <div class="empty-message" style="text-align:center; padding: 40px; color: var(--text-secondary);">@EmptyMessage</div>
}
else if (ViewMode == LibraryViewMode.Grid)
{
    <div class="library-grid-container"
         style="--grid-min-width: @(AppSettings.Library.GridItemWidth)px; --grid-gap: @(AppSettings.Library.GridGap)px; --card-padding: @(AppSettings.Library.GridItemPadding)px">

        <!-- Wrapped in standard-grid-layout to apply CSS Grid rules -->
        <div class="standard-grid-layout">
            @foreach (var item in _filteredItems)
            {
                @GridTemplate(item)
            }
        </div>
    </div>
}
else
{
    <!-- List View: Render directly without grid container constraints to ensure full width -->
    <div class="track-list" style="--list-art-size: @(AppSettings.Library.ListArtSize)px;">
        <table>
            <thead>
                @TableHeader
            </thead>
            <tbody>
                @foreach (var item in _filteredItems)
                {
                    <tr @onclick="() => OnItemClick.InvokeAsync(item)" class="hover-row">
                        @RowTemplate(item)
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<style>
    .hover-row:hover {
        background-color: var(--hover-bg);
        cursor: pointer;
    }
</style>

