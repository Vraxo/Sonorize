@using Sonorize.Core
@using Sonorize.Core.Services.Library
@using Sonorize.Core.Settings
@inject SonorizeSettings AppSettings
@inject ISettingsManager<SonorizeSettings> SettingsManager
@inject LibraryService LibraryService

<div class="extension-settings-container">
    <p class="description">Manage which file types are imported into your library.</p>

    <!-- Standard Formats Section -->
    <label class="sub-label">Standard Formats</label>
    <div class="standard-extensions-grid">
        @foreach (var ext in _knownExtensions)
        {
            bool isActive = IsActive(ext);
            <button class="extension-toggle @(isActive ? "active" : "")" @onclick="() => ToggleExtension(ext)">
                @ext
            </button>
        }
    </div>

    <!-- Custom Formats Section -->
    <label class="sub-label">Custom Formats</label>
    <div class="extension-list">
        @foreach (var ext in GetCustomExtensions())
        {
            <span class="extension-tag">
                @ext
                <button class="remove-tag-btn" @onclick="() => RemoveExtension(ext)">&times;</button>
            </span>
        }
        @if (!GetCustomExtensions().Any())
        {
            <span class="text-muted" style="font-size:0.9em;">No custom extensions added.</span>
        }
    </div>

    <div class="add-extension-row">
        <input type="text"
               @bind="_newExtension"
               placeholder=".ape"
               class="extension-input"
               @onkeyup="HandleExtensionKeyUp" />
        <button class="btn" @onclick="AddExtension">Add</button>
    </div>
</div>