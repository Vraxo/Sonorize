@using Sonorize.Core.Models
@using Sonorize.Core.Services
@using Sonorize.Core
@using Sonorize.Core.Services.Library
@using Sonorize.Core.Settings
@using Sonorize.Photino.Blazor.Shared
@implements IDisposable
@inject NavigationManager Nav
@inject SonorizeSettings AppSettings
@inject ISettingsManager<SonorizeSettings> SettingsManager
@inject LibraryService LibService

<aside class="@SidebarClass" style="@SidebarStyle">
    <div class="sidebar-content-wrapper">
        <div class="logo">
            <div style="display:flex; align-items:center;">
                <div class="logo-icon"></div>
                <span>Sonorize</span>
            </div>
            <button class="sidebar-toggle-btn" title="Close Sidebar" @onclick="OnClose">
                <i class="fas fa-angle-double-left"></i>
            </button>
        </div>
        <nav class="nav">
            <div class="sidebar-nav-item-wrapper @GetActiveState("")">
                <div class="sidebar-nav-item" @onclick='() => NavigateTo("")'>
                    <i class="fas fa-book"></i> Your Library
                </div>
            </div>
            <div class="sidebar-nav-item-wrapper @GetActiveState("albums")">
                <div class="sidebar-nav-item" @onclick='() => NavigateTo("albums")'>
                    <i class="fas fa-compact-disc"></i> Albums
                </div>
            </div>
            <div class="sidebar-nav-item-wrapper @GetActiveState("artists")">
                <div class="sidebar-nav-item" @onclick='() => NavigateTo("artists")'>
                    <i class="fas fa-microphone"></i> Artists
                </div>
            </div>
            <div class="sidebar-nav-item-wrapper @GetActiveState("folders")">
                <div class="sidebar-nav-item" @onclick='() => NavigateTo("folders")'>
                    <i class="fas fa-folder"></i> Folders
                </div>
            </div>
        </nav>

        <div class="playlists-wrapper">
            <SidebarPlaylistNav />
        </div>
    </div>

    <!-- Resizer Handle: Only active when open -->
    @if (IsOpen)
    {
        <div class="sidebar-resizer" @onmousedown="StartResize"></div>
    }
</aside>

<!-- Global Overlay to catch mouse events when dragging fast -->
@if (_isResizing)
{
    <div class="resize-overlay"
         @onmousemove="HandleMouseMove"
         @onmouseup="StopResize"
         @onmouseout="HandleMouseOut">
    </div>
}